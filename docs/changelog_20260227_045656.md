# clarc — Auto-Merge Worktrees and Manual Project Grouping

**Date**: 2026-02-27

## Overview

Added two layers of project unification in the scanner. Worktree directories (e.g., `--claude-worktrees-friendly-kalam`) are now automatically merged with their parent project. For other cases where the same codebase appears as separate projects (moved, renamed, opened from different subdirectories), users can manually group projects together via a new `projectGroups` config with a Settings UI.

## Changes

### Added: Auto-merge worktree directories

Extended `normalizeProjectId()` to strip `--claude-worktrees-{adjective}-{name}` suffixes before WSL normalization. Worktree directories now automatically merge into their parent project with no configuration needed.

### Added: Manual project grouping via `projectGroups` config

- New `projectGroups?: Record<string, string[]>` field in `ClarcConfig` maps a display name to a list of project IDs
- Scanner applies manual groups after auto-normalization, reusing the existing `scanMergedProject()` merge pipeline
- Config validation checks for empty groups and warns about overlapping membership

### Added: Project Groups Settings UI

- New "Project groups" section in the Data settings card
- Create/edit inline form with group name input and multi-select project checkbox list
- Ungroup button to dissolve a group
- Integrated into the existing save flow — groups are saved to `clarc.json` alongside other config

### Updated: API routes

- `POST /api/settings/config` handles `projectGroups` field (merge, clean, restartRequired)

### Updated: Documentation

- DEV_GUIDE.md: Scanner section documents worktree stripping, manual groups, and updated `ClarcConfig`
- USER_GUIDE.md: Settings section (project groups), config reference example
- Help.tsx: Settings section mentions project groups

---

## File Change Summary

### New Files (1)

| File | Description |
|------|-------------|
| `docs/changelog_20260227_045656.md` | This changelog |

### Modified Files (7)

| File | Change |
|------|--------|
| `src/data/scanner.ts` | Worktree suffix stripping in `normalizeProjectId()`, manual group application in `scanProjects()` |
| `src/shared/config.ts` | `projectGroups` in `ClarcConfig`, `pickKnownFields()`, `validateConfig()` |
| `src/server/routes/system.ts` | Handle `projectGroups` in POST config merge, clean, and restartRequired |
| `src/ui/pages/Settings.tsx` | Project Groups section with create/edit/ungroup UI, integrated into save flow |
| `src/ui/pages/Help.tsx` | Added project groups description in Settings section |
| `docs/DEV_GUIDE.md` | Scanner section: worktree stripping, manual groups, updated ClarcConfig |
| `docs/USER_GUIDE.md` | Settings section: project groups, config reference with `projectGroups` example |
