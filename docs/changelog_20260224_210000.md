# clarc — Rename, Archive, Bookmarks, Config File

**Date**: 2026-02-24

## Change 1: Rename to clarc

All "Claude Archive" references replaced with "clarc" across the codebase. The About description now reads "Inspired by the idea of a Claude archive — a local Claude Code history browser".

- `index.html` title: "clarc" (was "clarc — Claude Archive")
- `package.json` description updated
- `src/cli/index.ts` status output: "clarc — Status" (was "clarc -- Claude Archive Status")
- `src/ui/pages/Help.tsx` header, description, footer updated
- `src/ui/pages/Settings.tsx` About description updated

## Change 2: Archive Projects

Projects can be hidden from the sidebar by archiving them.

- **Sidebar** (`Sidebar.tsx`): Hover over any project to reveal an archive button. Archived projects are filtered out by default. When archived projects exist, an "N archived" toggle appears in the project list header. Clicking it shows archived projects at 50% opacity. When filtering/searching, all projects (including archived) are shown.
- **Settings** (`Settings.tsx`): New "Archived Projects" section lists all archived projects with Unarchive buttons and project metadata (sessions, messages).
- **useSettings** (`useSettings.ts`): Added `archivedProjects: string[]` to settings with helpers `isProjectArchived()` and `toggleProjectArchived()`.
- **Icons** (`Icons.tsx`): Added `ArchiveIcon` (box with horizontal line) and `FolderIcon`.

## Change 3: Bookmarks / Favorites

Sessions can be bookmarked from the session or agent detail view and appear on the Dashboard.

- **SessionDetail** (`SessionDetail.tsx`): Star icon in the glass header toggles bookmark state. Filled star when bookmarked, outline when not.
- **AgentDetail** (`AgentDetail.tsx`): Same bookmark toggle, bookmarks the parent session ID.
- **Dashboard** (`Dashboard.tsx`): New "Bookmarked Sessions" section between stat cards and activity chart. Fetches bookmarked session data from a new API endpoint. Shows session summary, project, model, message count, cost, and time.
- **API** (`sessions.ts`): New `GET /api/sessions/bookmarks?ids=id1,id2,id3` endpoint returns summary data for the given session IDs.
- **useSettings** (`useSettings.ts`): Added `bookmarkedSessions: string[]` with helpers `isSessionBookmarked()` and `toggleSessionBookmark()`.
- **Icons** (`Icons.tsx`): Added `StarIcon` (outline) and `StarFilledIcon` (filled).

## Change 4: clarc.json Config File System

All clarc configuration can now be managed via a `clarc.json` config file, editable from the Settings page. Priority: env vars > clarc.json > defaults.

### New file: `src/shared/config.ts`
- `ClarcConfig` interface: `sourceDir`, `dataDir`, `port`, `syncIntervalMs`
- `getConfigFilePath()`: binary mode → next to binary; dev mode → `~/.config/clarc/clarc.json`
- `readConfigSync()`: synchronous read for module-level use in `paths.ts`
- `readConfig()`: async read for API endpoints
- `validateConfig()`: sourceDir must have `projects/` subdir, dataDir must be writable, port 1–65535, syncIntervalMs >= 10000
- `writeConfig()`: writes JSON with pretty-print

### Modified: `src/shared/paths.ts`
- Imports `readConfigSync` and `getConfigFilePath` from `config.ts`
- Added `parseIntOrUndefined()` helper for safe numeric parsing
- All exports use `??` (nullish coalescing) chain: `env ?? config ?? default`
- New export: `CONFIG_FILE`

### Modified: `src/data/sync-scheduler.ts`
- Added `restartPeriodicSync(intervalMs)` — stops and restarts the timer with a new interval

### Modified: `src/server/routes/system.ts`
- Enhanced `GET /api/settings/info`: now returns `configFilePath`, `configFile` (JSON contents), `envOverrides` (boolean flags for which fields are locked by env vars)
- New `POST /api/settings/config`: validates, merges, and writes config. Hot-reloads sync interval. Returns `restartRequired` flag for sourceDir/dataDir/port changes.

### Modified: `src/ui/pages/Settings.tsx`
- Data section now editable: text inputs for sourceDir, dataDir, number inputs for port and sync interval (in seconds)
- Env-overridden fields show amber "env" badge and are read-only
- Save button with inline validation errors, warning banners, and success/restart feedback
- New `EnvBadge` component, `INPUT_STYLE`/`INPUT_ERROR_STYLE` constants

## Change 5: Documentation Updates

- **USER_GUIDE.md**: Updated description, sidebar (archive toggle, archive button), dashboard (bookmarks), session detail (bookmark star), settings (editable data, archived projects, clarc.json), configuration (config file section, env var table with SYNC_INTERVAL_MS), CLI status output
- **DEV_GUIDE.md**: Added config.ts section, updated paths.ts code/docs, updated sync-scheduler (restartPeriodicSync), updated system.ts API (POST /settings/config, enhanced GET), added sessions bookmarks endpoint, updated useSettings (archivedProjects, bookmarkedSessions, helpers), updated Icons count, updated Sidebar/Settings/Dashboard descriptions, updated routing table, updated portable data directory description

---

## File Change Summary

### New Files (1)

| File | Description |
|------|-------------|
| `src/shared/config.ts` | Config file I/O, validation, types for clarc.json |

### Modified Files (16)

| File | Changes |
|------|---------|
| `index.html` | Title updated to "clarc" |
| `package.json` | Description updated |
| `src/cli/index.ts` | CLI description and status output strings |
| `src/shared/paths.ts` | Config layer: imports config.ts, parseIntOrUndefined, CONFIG_FILE export, nullish coalescing chain |
| `src/data/sync-scheduler.ts` | Added restartPeriodicSync() |
| `src/server/routes/system.ts` | Enhanced GET /settings/info, added POST /settings/config |
| `src/server/routes/sessions.ts` | Added GET /bookmarks endpoint |
| `src/ui/hooks/useSettings.ts` | Added archivedProjects, bookmarkedSessions, helper functions |
| `src/ui/components/Icons.tsx` | Added ArchiveIcon, StarIcon, StarFilledIcon, FolderIcon |
| `src/ui/components/Sidebar.tsx` | Archive filtering, toggle, per-project archive button |
| `src/ui/pages/Dashboard.tsx` | Bookmarked sessions section |
| `src/ui/pages/SessionDetail.tsx` | Bookmark toggle star |
| `src/ui/pages/AgentDetail.tsx` | Bookmark toggle star |
| `src/ui/pages/Settings.tsx` | Editable data config, archived projects section, updated About |
| `src/ui/pages/Help.tsx` | Updated description, header, footer |
| `docs/USER_GUIDE.md` | Updated for all new features |
| `docs/DEV_GUIDE.md` | Updated for all new features and architecture changes |
